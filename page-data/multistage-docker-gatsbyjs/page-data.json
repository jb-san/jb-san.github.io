{"componentChunkName":"component---node-modules-gatsby-theme-blog-src-templates-post-js","path":"/multistage-docker-gatsbyjs","webpackCompilationHash":"668401ed4e56d61dde25","result":{"data":{"post":{"id":"9d678eef-df32-58a5-8b5f-ac57ff4f2f25","title":"Building and serving gatsbyjs with docker","date":"September 26, 2020","excerpt":"On a recent project I have been working on, I had to find a way to host a gatsbyjs project in a  docker  container.\nAfter a quick search for…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Building and serving gatsbyjs with docker\",\n  \"date\": \"2020-09-26T00:00:00.000Z\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"On a recent project I have been working on, I had to find a way to host a gatsbyjs project in a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.docker.com/\"\n  }), \"docker\"), \" container.\\nAfter a quick search for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsbyjs docker\"), \", most of the result pointed me to the fact that gatsbyjs have \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/gatsbyjs/gatsby-docker\"\n  }), \"official docker images\"), \",\\nbut when using it like shown in the README\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"FROM gatsbyjs/gatsby:onbuild as build\\n\\nFROM gatsbyjs/gatsby\\nCOPY --from=build /app/public /pub\\n\")), mdx(\"p\", null, \"I could not get it to work, after searching through the issues i found out that the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/gatsbyjs/gatsby-docker/issues/38\"\n  }), \"docker images needs to be updated\"), \" but its still open so i decided to take matters into my own hands.\"), mdx(\"h2\", {\n    \"id\": \"multistage-docker-builds\"\n  }, \"Multistage docker builds\"), mdx(\"p\", null, \"Docker has this awesome feature called \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.docker.com/develop/develop-images/multistage-build/\"\n  }), \"multistage build\"), \" which allows us to basicly structure our dockerfile\\nin a way to minimize the size of the final image. A traditional dockerfile would look something like this\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-docker\"\n  }), \"FROM node:14.11.0\\n#\\n# Install and setup nginx to serve static files, removed for brevity.\\n#\\nWORKDIR /app\\n\\nCOPY package.json package-lock.json ./\\nRUN npm ci\\n\\nCOPY . ./\\nRUN npm run build\\n\\nRUN mv /app/public /usr/share/nginx/html\\n\\n\")), mdx(\"p\", null, \"this would work, but you see that \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"FROM node:14.11.0\"), \" line at the top of the Dockerfile, that means that the final image will have node included, and all the dependencies that the application needs to build.\\nthere is a better way.\"), mdx(\"h3\", {\n    \"id\": \"enter-multistage\"\n  }, \"Enter multistage\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"FROM node:14.11.0 AS builder\\nWORKDIR /app\\nCOPY package.json package-lock.json ./\\nRUN npm ci\\nCOPY . ./\\nRUN npm run build\\n\\nFROM nginx:alpine\\nCOPY --from=builder /app/public /usr/share/nginx/html\\n\")), mdx(\"p\", null, \"As you can see it starts of similarly,we have one stage that uses the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"node:14.11.0\"), \" image, it sets everything up and builds the public folder with the generated gatsby site,\\nbut at the end of the file we have a new \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"FROM nginx:alpine\"), \" and we then copy in only the public folder, This means that our final docker image will only contain our finished built site, and the bare minimun nginx to serve those files.\"));\n}\n;\nMDXContent.isMDXComponent = true;"},"site":{"siteMetadata":{"title":"X3M"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"9d678eef-df32-58a5-8b5f-ac57ff4f2f25","excerpt":"On a recent project I have been working on, I had to find a way to host a gatsbyjs project in a  docker  container.\nAfter a quick search for…","slug":"/multistage-docker-gatsbyjs","title":"Building and serving gatsbyjs with docker","date":"September 26, 2020","siteTitle":"X3M","socialLinks":[{"name":"github","url":"https://github.com/jb-san"},{"name":"linkedin","url":"https://www.linkedin.com/in/jonathan-borg-8a520b97/"}],"previous":{"node":{"id":"86240123-a6fc-558b-bf9c-f1f909e6ade9","excerpt":"So i have for a long time used third party software to rebind my keyboard so that I could\nuse the US keyboard layout when i program and…","slug":"/custom-keyboard-layout","title":"Custom keyboard layout","date":"September 05, 2020"}},"next":null}}}